<?php
include 'validasi_input.php';
include 'logic_konversi.php';

$hasil = "";
$nilai = $_POST["nilai"] ?? '';
$jenis = $_POST["jenis"] ?? '';
$dari  = $_POST["dari"] ?? '';
$ke    = $_POST["ke"] ?? '';

if ($_SERVER["REQUEST_METHOD"] == "POST") {

    $validasi = validasiInput($nilai, $jenis, $dari, $ke);

    if ($validasi !== null) {
        $hasil = $validasi;
    } else {
        switch ($jenis) {
            case "panjang": $hasil = konversiPanjang($nilai, $dari, $ke); break;
            case "berat":   $hasil = konversiBerat($nilai, $dari, $ke); break;
            case "suhu":    $hasil = konversiSuhu($nilai, $dari, $ke); break;
            default:        $hasil = "Jenis konversi tidak valid.";
        }

        if (is_numeric($hasil)) {
            $hasil = "‚úÖ <b>$nilai $dari = " . round($hasil, 4) . " $ke</b>";
        } elseif ($hasil == "error_satuan") {
            $hasil = "‚ö† Maaf, Anda salah memilih satuan.";
        }
    }
}
?>

<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Konversi Satuan</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

<style>
/* CSS kamu aman, tidak ada masalah */
body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #a18cd1, #fbc2eb);
    height: 100vh;
    margin: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}
header { text-align: center; margin-bottom: 20px; }
header h1 { margin: 0; font-size: 34px; }
header h2 { margin-top: 8px; font-size: 18px; }
.container {
    background: #fff;
    padding: 30px 25px;
    width: 420px;
    border-radius: 20px;
}
input, select, button {
    width: 100%;
    padding: 12px;
    margin-bottom: 15px;
    border-radius: 10px;
    border: 1px solid #ccc;
}
button {
    background: #7a5eff;
    color: white;
    cursor: pointer;
}
.result-box {
    background: #f3f0ff;
    padding: 15px;
    border-radius: 10px;
    margin-top: 20px;
    text-align: center;
}
.error {
    background: #ffe6e6;
    color: #b30000;
    padding: 12px;
    border-radius: 8px;
    margin-top: 15px;
}
</style>

<script>
function updateSatuan() {
    const jenis = document.getElementById("jenis").value;
    const dari = document.getElementById("dari");
    const ke = document.getElementById("ke");

    const satuan = {
        suhu: ['C', 'F', 'K'],
        panjang: ['km', 'hm', 'dam', 'm', 'dm', 'cm', 'mm'],
        berat: ['kg', 'hg', 'dag', 'g', 'dg', 'cg', 'mg']
    };

    dari.innerHTML = "";
    ke.innerHTML = "";

    if (satuan[jenis]) {
        satuan[jenis].forEach(s => {
            dari.innerHTML += <option value="${s}">${s}</option>;
            ke.innerHTML += <option value="${s}">${s}</option>;
        });
    }
}
</script>

</head>
<body>

<header>
    <h1>Konversi Satuan</h1>
    <h2>Suhu üå° | Panjang üìè | Berat ‚öñ</h2>
</header>

<div class="container">
    <form method="POST">
        <select id="jenis" name="jenis" required onchange="updateSatuan()">
            <option value="">-- Pilih Jenis Konversi --</option>
            <option value="suhu" <?= $jenis=='suhu'?'selected':'' ?>>Suhu</option>
            <option value="panjang" <?= $jenis=='panjang'?'selected':'' ?>>Panjang</option>
            <option value="berat" <?= $jenis=='berat'?'selected':'' ?>>Berat</option>
        </select>

        <input type="number" step="0.01" name="nilai" placeholder="Masukkan nilai angka..." value="<?= htmlspecialchars($nilai) ?>" required>

        <select id="dari" name="dari" required></select>
        <select id="ke" name="ke" required></select>

        <button type="submit">üöÄ Konversi Sekarang</button>
    </form>

    <?php if ($hasil): ?>
        <div class="<?= strpos($hasil, '‚ö†') !== false ? 'error' : 'result-box' ?>">
            <?= $hasil ?>
        </div>
    <?php endif; ?>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    updateSatuan();

    <?php if ($dari): ?>
        document.getElementById("dari").value = "<?= $dari ?>";
    <?php endif; ?>

    <?php if ($ke): ?>
        document.getElementById("ke").value = "<?= $ke ?>";
    <?php endif; ?>
});
</script>

</body>
</html>
